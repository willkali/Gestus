# Script para executar testes do projeto Gestus
# Uso: .\test.ps1 [categoria] [filtro]
# Exemplos:
#   .\test.ps1                           # Todos os testes
#   .\test.ps1 unit                      # Testes unit√°rios apenas
#   .\test.ps1 controller                # Testes de controllers apenas
#   .\test.ps1 auth                      # Testes de autentica√ß√£o apenas
#   .\test.ps1 custom "MinhaClasse"      # Filtro personalizado

param(
    [string]$Category = "",
    [string]$Filter = ""
)

# Caminho do projeto de testes
$TestProject = "Tests\Gestus.Tests\Gestus.Tests.csproj"

# Fun√ß√£o para executar testes com filtro
function Invoke-TestsWithFilter([string]$FilterExpression, [string]$Description) {
    Write-Host "üéØ $Description" -ForegroundColor Cyan
    dotnet test $TestProject --filter $FilterExpression --verbosity normal
}

# Escolher filtro baseado na categoria
switch ($Category.ToLower()) {
    "unit" {
        Invoke-TestsWithFilter "Category!=Controller" "Executando testes unit√°rios (exceto controllers)"
    }
    "controller" {
        Invoke-TestsWithFilter "Category~Controller" "Executando todos os testes de controllers"
    }
    "auth" {
        Invoke-TestsWithFilter "Category=Controller.Autenticacao" "Executando testes do AutenticacaoController"
    }
    "login" {
        Invoke-TestsWithFilter "Category=Controller.Autenticacao&Category=Action.Login" "Executando testes de Login"
    }
    "custom" {
        if ($Filter) {
            Invoke-TestsWithFilter "DisplayName~$Filter" "Executando testes: $Filter"
        } else {
            Write-Host "‚ùå Para categoria 'custom', forne√ßa um filtro: .\test.ps1 custom 'MeuFiltro'" -ForegroundColor Red
            exit 1
        }
    }
    "help" {
        Write-Host "üìö Ajuda - Como usar o script test.ps1" -ForegroundColor Yellow
        Write-Host ""
        Write-Host "Uso: .\test.ps1 [categoria] [filtro]" -ForegroundColor White
        Write-Host ""
        Write-Host "Categorias dispon√≠veis:" -ForegroundColor Cyan
        Write-Host "  ‚Ä¢ (vazio)     - Executa todos os testes" -ForegroundColor Gray
        Write-Host "  ‚Ä¢ unit        - Testes unit√°rios (exceto controllers)" -ForegroundColor Gray
        Write-Host "  ‚Ä¢ controller  - Todos os testes de controllers" -ForegroundColor Gray
        Write-Host "  ‚Ä¢ auth        - Testes do AutenticacaoController" -ForegroundColor Gray
        Write-Host "  ‚Ä¢ login       - Testes espec√≠ficos de Login" -ForegroundColor Gray
        Write-Host "  ‚Ä¢ custom      - Filtro personalizado (requer par√¢metro Filter)" -ForegroundColor Gray
        Write-Host "  ‚Ä¢ help        - Mostra esta ajuda" -ForegroundColor Gray
        Write-Host ""
        Write-Host "Exemplos:" -ForegroundColor Cyan
        Write-Host "  .\test.ps1                    # Todos os testes" -ForegroundColor Green
        Write-Host "  .\test.ps1 auth               # Testes de autentica√ß√£o" -ForegroundColor Green
        Write-Host "  .\test.ps1 custom 'Usuario'   # Testes que contenham 'Usuario'" -ForegroundColor Green
        Write-Host ""
        exit 0
    }
    default {
        Write-Host "üß™ Executando todos os testes" -ForegroundColor Cyan
        dotnet test $TestProject --verbosity normal
    }
}

if ($LASTEXITCODE -eq 0) {
    Write-Host "‚úÖ Testes conclu√≠dos com sucesso!" -ForegroundColor Green
} else {
    Write-Host "‚ùå Alguns testes falharam!" -ForegroundColor Red
}
