using System.ComponentModel.DataAnnotations;

namespace Gestus.Modelos;

/// <summary>
/// Status/Estados poss√≠veis para uma aplica√ß√£o
/// </summary>
public class StatusAplicacao
{
    public int Id { get; set; }
    
    [Required]
    [MaxLength(50)]
    public string Codigo { get; set; } = string.Empty; // "ativa", "manutencao", "desabilitada", "desenvolvimento"
    
    [Required]
    [MaxLength(100)]
    public string Nome { get; set; } = string.Empty; // "Ativa", "Em Manuten√ß√£o", "Desabilitada"
    
    [Required]
    [MaxLength(200)]
    public string Descricao { get; set; } = string.Empty;
    
    /// <summary>
    /// Cor de fundo para representar o status (hexadecimal)
    /// </summary>
    [MaxLength(7)]
    public string CorFundo { get; set; } = "#6c757d"; // #28a745 (verde), #ffc107 (amarelo), #dc3545 (vermelho)
    
    /// <summary>
    /// Cor do texto para garantir contraste (hexadecimal)
    /// </summary>
    [MaxLength(7)]
    public string CorTexto { get; set; } = "#ffffff";
    
    /// <summary>
    /// √çcone para representar o status
    /// </summary>
    [MaxLength(50)]
    public string? Icone { get; set; } // "‚úÖ", "‚ö†Ô∏è", "‚ùå", "üîß", "üöß"
    
    /// <summary>
    /// Define se aplica√ß√µes com este status podem ser acessadas por usu√°rios
    /// </summary>
    public bool PermiteAcesso { get; set; } = true;
    
    /// <summary>
    /// Define se aplica√ß√µes com este status podem receber novos usu√°rios
    /// </summary>
    public bool PermiteNovoUsuario { get; set; } = true;
    
    /// <summary>
    /// Define se aplica√ß√µes com este status aparecem na listagem para usu√°rios normais
    /// </summary>
    public bool VisivelParaUsuarios { get; set; } = true;
    
    /// <summary>
    /// A√ß√µes autom√°ticas que devem ser executadas quando uma aplica√ß√£o muda para este status (JSON)
    /// Exemplo: {"notificarAdmins": true, "enviarEmail": true, "logAuditoria": true}
    /// </summary>
    public string? AcoesAutomaticas { get; set; } = "{}";
    
    /// <summary>
    /// Mensagem exibida aos usu√°rios quando tentam acessar aplica√ß√£o neste status
    /// </summary>
    [MaxLength(500)]
    public string? MensagemUsuario { get; set; }
    
    public bool Ativo { get; set; } = true;
    public bool Padrao { get; set; } = false; // Status padr√£o do sistema
    public bool PermiteExclusao { get; set; } = true;
    public int Ordem { get; set; } = 0; // Para ordena√ß√£o na interface
    
    /// <summary>
    /// Prioridade do status (1-10): 1=Baixa, 10=Cr√≠tica
    /// Usado para alertas e notifica√ß√µes
    /// </summary>
    public int Prioridade { get; set; } = 5;
    
    public DateTime DataCriacao { get; set; } = DateTime.UtcNow;
    public DateTime? DataAtualizacao { get; set; }
    public int? CriadoPorId { get; set; }
    public int? AtualizadoPorId { get; set; }
    
    // Relacionamentos
    public virtual Usuario? CriadoPor { get; set; }
    public virtual Usuario? AtualizadoPor { get; set; }
    public virtual ICollection<Aplicacao> Aplicacoes { get; set; } = new List<Aplicacao>();
}

/// <summary>
/// Hist√≥rico de mudan√ßas de status de aplica√ß√µes
/// </summary>
public class HistoricoStatusAplicacao
{
    public int Id { get; set; }
    
    public int AplicacaoId { get; set; }
    public int StatusAnteriorId { get; set; }
    public int StatusNovoId { get; set; }
    
    public DateTime DataMudanca { get; set; } = DateTime.UtcNow;
    public int? AlteradoPorId { get; set; }
    
    [MaxLength(500)]
    public string? Motivo { get; set; }
    
    [MaxLength(1000)]
    public string? Observacoes { get; set; }
    
    /// <summary>
    /// Se a mudan√ßa foi autom√°tica (por sistema) ou manual (por usu√°rio)
    /// </summary>
    public bool MudancaAutomatica { get; set; } = false;
    
    // Relacionamentos
    public virtual Aplicacao Aplicacao { get; set; } = null!;
    public virtual StatusAplicacao StatusAnterior { get; set; } = null!;
    public virtual StatusAplicacao StatusNovo { get; set; } = null!;
    public virtual Usuario? AlteradoPor { get; set; }
}